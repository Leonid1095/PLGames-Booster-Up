# PLGames Booster UP - Улучшенная спецификация проекта

> Доработанная версия исходного промта с учётом конкурентного анализа.
> Изменения и дополнения помечены как **[НОВОЕ]** или **[ИЗМЕНЕНО]**.

---

## 1. Продукт и цель

**Сервис:** PLGames Booster UP — игровой сетевой ускоритель для русскоязычных геймеров.

**Позиционирование:** Единственный game-booster, специализированный на аудитории РФ/СНГ с фокусом на обход региональных блокировок и оптимизацию маршрутов до EU/US серверов.

### Цели продукта:

1. Снизить пинг и потери пакетов в онлайн-играх за счёт маршрутизации через оптимальные узлы
2. Обходить региональные блокировки игр (РФ) через зарубежные узлы (DE, SE, US, LV)
3. Дать удобный десктоп-клиент с визуалом уровня GearUP: выбор игры, выбор региона, пинг в реальном времени
4. **[НОВОЕ]** Показывать честную метрику "ДО и ПОСЛЕ" ускорения (benchmark-режим как у NoPing/Outfox)
5. **[НОВОЕ]** Обеспечить прозрачный биллинг без скрытых списаний (главная жалоба на конкурентов)

### Целевая аудитория:
- Геймеры из РФ/СНГ, 16–35 лет
- Играющие на EU/US серверах
- Столкнувшиеся с блокировками (Steam, Epic, игровые серверы)

### Платформа MVP:
- **Сервер:** Ubuntu 24.04, основной узел DE + дополнительные: SE, US, LV
- **Клиент:** Windows x64
- **Позже (v2):** Android, **[НОВОЕ]** Telegram-бот для управления

---

## 2. Архитектура

### 2.1. Компоненты системы

```
┌─────────────────────────────────────────────────────┐
│                    ПОЛЬЗОВАТЕЛЬ                      │
│  Windows-клиент (Tauri + React)                     │
│  ┌─────────┐ ┌──────────┐ ┌───────────────────┐    │
│  │ UI/React│ │WireGuard │ │Split-tunnel routes│    │
│  │         │ │  tunnel  │ │ (game IPs only)   │    │
│  └────┬────┘ └────┬─────┘ └───────┬───────────┘    │
└───────┼───────────┼───────────────┼─────────────────┘
        │ API       │ WG tunnel     │ Game traffic
        ▼           ▼               ▼
┌───────────────────────────────────────────────────────┐
│              ЦЕНТРАЛЬНЫЙ СЕРВЕР (DE)                   │
│  ┌────────┐ ┌────────┐ ┌──────┐ ┌─────┐ ┌────────┐  │
│  │FastAPI │ │Next.js │ │Postgr│ │Redis│ │Promethe│  │
│  │  API   │ │Landing │ │  SQL │ │     │ │us+Graf │  │
│  └────────┘ └────────┘ └──────┘ └─────┘ └────────┘  │
└───────────────────────────────────────────────────────┘
        │
        ▼ Управление peer-ами и метриками
┌──────────────────────────────────────────────────────┐
│              GATEWAY NODES (WireGuard)                │
│  ┌────┐  ┌────┐  ┌────┐  ┌────┐                    │
│  │ DE │  │ SE │  │ US │  │ LV │                    │
│  └──┬─┘  └──┬─┘  └──┬─┘  └──┬─┘                    │
│     │NAT    │NAT    │NAT    │NAT                    │
└─────┼───────┼───────┼───────┼────────────────────────┘
      ▼       ▼       ▼       ▼
   Игровые серверы (Steam, Riot, Blizzard, etc.)
```

### 2.2. Компоненты (подробно)

#### A. Landing-сайт
- Домен: plgames.gg (или аналог)
- Одностраничник: описание, тарифы, скачивание
- Регистрация/кабинет → бэкенд API
- **[НОВОЕ]** Интерактивный speed-test на лендинге (пинг до наших узлов прямо в браузере через WebSocket)

#### B. Бэкенд-API
REST/JSON API:
- Регистрация/логин (email + пароль)
- **[НОВОЕ]** OAuth через Telegram, Discord, Steam (приоритет для ЦА)
- Список узлов и метрики
- Игровые профили (IP/CIDR + порты)
- Генерация WireGuard-конфигов
- Учёт сессий и подписок
- **[НОВОЕ]** Benchmark API — замер пинга ДО/ПОСЛЕ для отчётности
- **[НОВОЕ]** Webhook для Telegram-бота (статус подписки, уведомления)

#### C. Gateway Nodes
- VPS Ubuntu 24 в регионах: DE, SE, US, LV
- WireGuard-сервер + NAT
- **[НОВОЕ]** Health-check агент с push метрик в Prometheus
- **[НОВОЕ]** Автоматическое масштабирование peer-лимитов (мониторинг загрузки)

#### D. Десктоп-клиент Windows
- **[ИЗМЕНЕНО]** Tauri + React (вместо Electron — на 80% меньше ресурсов, критично для геймеров)
- WireGuard-туннель + split-tunneling
- **[НОВОЕ]** Авто-детект запущенных игр (мониторинг процессов)
- **[НОВОЕ]** Benchmark-режим: замер пинга без ускорения и с ускорением

#### E. Админ-панель
- Веб-интерфейс: пользователи, подписки, сессии
- Управление узлами
- Редактор игровых профилей
- **[НОВОЕ]** Дашборд с метриками в реальном времени (Grafana embed)

#### F. **[НОВОЕ]** Telegram-бот
- Статус подписки, остаток trial
- Быстрое подключение к ускорению (генерация конфига)
- Уведомления о проблемах с узлами
- Реферальная программа

---

## 3. Инфраструктура и серверы

### 3.1. Центральный сервер (DE)
- Ubuntu 24.04, 2 vCPU, 4 GB RAM, 40 GB SSD
- Docker Compose (MVP)
- Сервисы:
  - `api` — FastAPI (Python)
  - `web` — Next.js (лендинг + кабинет)
  - `db` — PostgreSQL 16
  - `redis` — кэш метрик и сессий
  - `prometheus` + `grafana` — мониторинг
  - **[НОВОЕ]** `bot` — Telegram-бот (aiogram)

### 3.2. Gateway Nodes

| Узел | Локация | Назначение | Spec |
|------|---------|------------|------|
| DE | Германия (Франкфурт) | Основной, EU-игры | 2 vCPU, 4 GB RAM |
| SE | Швеция (Стокгольм) | Скандинавия, низкий пинг из СПб | 1 vCPU, 2 GB RAM |
| US | США (Нью-Йорк) | NA-серверы игр | 2 vCPU, 2 GB RAM |
| LV | Латвия (Рига) | Минимальный пинг из РФ | 1 vCPU, 2 GB RAM |

Каждый узел:
- Ubuntu 24.04
- Открытые порты: UDP 51820 (WireGuard), TCP 8443 (health-check)
- **[НОВОЕ]** Резервный UDP-порт для obfuscation (на случай блокировки WireGuard по DPI)

### 3.3. Сетевая конфигурация узла

```bash
# WireGuard
# Интерфейс wg0: 10.10.X.1/24 (X — уникален на каждом узле)
# Отдельный peer на каждого пользователя (AllowedIPs = 10.10.X.Y/32)

# NAT
iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE

# SYSCTL
net.ipv4.ip_forward=1
net.ipv6.conf.all.forwarding=1
```

**[НОВОЕ]** Дополнительные оптимизации sysctl для гейминга:
```bash
# Увеличение буферов UDP
net.core.rmem_max=26214400
net.core.wmem_max=26214400
net.core.rmem_default=1048576
net.core.wmem_default=1048576

# Уменьшение задержки conntrack
net.netfilter.nf_conntrack_udp_timeout=30
net.netfilter.nf_conntrack_udp_timeout_stream=60

# Отключение reverse path filtering для WG
net.ipv4.conf.wg0.rp_filter=0

# BBR congestion control
net.core.default_qdisc=fq
net.ipv4.tcp_congestion_control=bbr
```

---

## 4. Бэкенд: логика и API

### 4.1. Технологический стек
- **Язык:** Python 3.12+ (FastAPI) — быстрая разработка MVP
- **БД:** PostgreSQL 16
- **Кэш/очередь:** Redis 7
- **Аутентификация:** JWT (access + refresh tokens)
- **[НОВОЕ]** Task queue: Celery + Redis (для асинхронных задач: генерация конфигов, метрики)
- **[НОВОЕ]** Миграции: Alembic

### 4.2. Основные сущности

```python
# User
class User:
    id: UUID
    email: str
    password_hash: str
    telegram_id: int | None          # [НОВОЕ]
    discord_id: str | None           # [НОВОЕ]
    plan: Enum  # free, trial, pro
    plan_expires_at: datetime | None
    referral_code: str               # [НОВОЕ]
    referred_by: UUID | None         # [НОВОЕ]
    created_at: datetime

# Node
class Node:
    id: UUID
    location: str  # DE, SE, US, LV
    city: str                        # [НОВОЕ] Frankfurt, Stockholm, etc.
    public_ip: str
    wg_port: int
    wg_public_key: str
    status: Enum  # online, offline, maintenance
    priority: int
    max_clients: int
    current_clients: int             # [НОВОЕ]
    avg_rtt_ms: float                # [НОВОЕ] средний пинг до игровых серверов

# GameProfile
class GameProfile:
    id: UUID
    name: str
    slug: str
    icon_url: str                    # [НОВОЕ]
    cover_url: str                   # [НОВОЕ]
    platform: Enum  # pc, mobile, both
    cidrs: list[str]   # IP/CIDR игровых серверов
    ports: list[PortRange]  # UDP/TCP порты
    recommended_node: str | None     # [НОВОЕ] предпочтительный регион
    is_verified: bool                # [НОВОЕ] проверен ли профиль

# Session
class Session:
    id: UUID
    user_id: UUID
    node_id: UUID
    game_id: UUID
    start_time: datetime
    end_time: datetime | None
    avg_ping_ms: float | None
    avg_loss_pct: float | None
    ping_before_ms: float | None     # [НОВОЕ] пинг ДО ускорения
    ping_after_ms: float | None      # [НОВОЕ] пинг ПОСЛЕ ускорения
    bytes_transferred: int           # [НОВОЕ] для аналитики

# [НОВОЕ] Subscription
class Subscription:
    id: UUID
    user_id: UUID
    plan: Enum  # trial, monthly, quarterly, yearly
    status: Enum  # active, expired, cancelled
    started_at: datetime
    expires_at: datetime
    payment_provider: str  # stripe, robokassa, cryptomus
    auto_renew: bool
```

### 4.3. API-эндпоинты

#### Аутентификация
```
POST /api/v1/auth/register          — регистрация (email + пароль)
POST /api/v1/auth/login             — логин → JWT tokens
POST /api/v1/auth/refresh           — обновление access token
POST /api/v1/auth/telegram          — [НОВОЕ] OAuth через Telegram
POST /api/v1/auth/discord           — [НОВОЕ] OAuth через Discord
```

#### Игры и узлы
```
GET  /api/v1/games                  — список игр с профилями
GET  /api/v1/games/{slug}           — детали игры
GET  /api/v1/games/search?q=        — [НОВОЕ] поиск игр
GET  /api/v1/nodes                  — список узлов с метриками
GET  /api/v1/nodes/{id}/ping        — [НОВОЕ] текущий пинг до узла
```

#### Сессии
```
POST /api/v1/sessions/start         — старт сессии
  Request:  { game_id, preferred_region, client_public_key }
  Response: { node, wg_config, game_ips, ping_before }

POST /api/v1/sessions/stop          — остановка сессии
  Request:  { session_id, metrics: { avg_ping, avg_loss, ping_samples[] } }

GET  /api/v1/sessions/active        — [НОВОЕ] текущая активная сессия
GET  /api/v1/sessions/history       — история сессий
```

#### Пользователь и подписки
```
GET  /api/v1/me                     — профиль пользователя
GET  /api/v1/me/subscription        — [НОВОЕ] текущая подписка
POST /api/v1/me/subscription/cancel — [НОВОЕ] отмена подписки (одна кнопка!)
GET  /api/v1/me/stats               — [НОВОЕ] статистика (общее время, сэкономленный пинг)
```

#### [НОВОЕ] Benchmark
```
POST /api/v1/benchmark/start        — замер пинга до игровых серверов без ускорения
POST /api/v1/benchmark/result       — сравнение ДО/ПОСЛЕ
```

#### [НОВОЕ] Платежи
```
POST /api/v1/payments/create        — создание платежа
POST /api/v1/payments/webhook       — webhook от платёжной системы
GET  /api/v1/payments/history       — история платежей
```

---

## 5. Gateway Nodes: работа

### 5.1. WireGuard

На каждом узле:
- Серверный конфиг `wg0` с постоянным ключевым парой
- Бэкенд динамически добавляет/удаляет peers через `wg set` API
- Каждый пользователь получает уникальный `10.10.X.Y/32`

Генерация клиентского конфига (бэкенд):
```ini
[Interface]
PrivateKey = <client_private_key>
Address = 10.10.X.Y/32
DNS = 1.1.1.1

[Peer]
PublicKey = <server_public_key>
Endpoint = <node_public_ip>:51820
AllowedIPs = 10.10.X.0/24, <game_server_ips>
PersistentKeepalive = 25
```

**[НОВОЕ]** AllowedIPs формируются динамически из GameProfile.cidrs — только игровой трафик через туннель.

### 5.2. Мониторинг узлов

Агент на каждом узле (Python/Go скрипт):
- Каждые 30 сек пингует ключевые IP из GameProfile
- Отправляет метрики в Prometheus:
  - `node_game_rtt_ms{game, node, target_ip}`
  - `node_game_loss_pct{game, node, target_ip}`
  - `node_wg_peers_count{node}`
  - `node_bandwidth_mbps{node, direction}`
- **[НОВОЕ]** Alert при потере > 5% или RTT > 100ms → уведомление в Telegram админам

### 5.3. **[НОВОЕ]** Выбор лучшего узла (алгоритм)

```python
def select_best_node(game_id: str, preferred_region: str | None) -> Node:
    nodes = get_online_nodes()
    game = get_game_profile(game_id)

    scored = []
    for node in nodes:
        score = 0
        # Пинг до игровых серверов (вес 50%)
        avg_rtt = get_node_game_rtt(node.id, game.id)
        score += (200 - avg_rtt) * 0.5

        # Загруженность (вес 20%)
        load = node.current_clients / node.max_clients
        score += (1 - load) * 100 * 0.2

        # Потери пакетов (вес 20%)
        loss = get_node_game_loss(node.id, game.id)
        score += (100 - loss * 100) * 0.2

        # Предпочтение пользователя (вес 10%)
        if preferred_region and node.location == preferred_region:
            score += 10

        # Рекомендация профиля игры
        if game.recommended_node == node.location:
            score += 5

        scored.append((node, score))

    return max(scored, key=lambda x: x[1])[0]
```

---

## 6. Клиент Windows: функционал и UX

### 6.1. Технологии

- **Оболочка:** Tauri 2.x + React + TypeScript
  - **[ИЗМЕНЕНО]** Tauri вместо Electron: ~10 MB вместо ~150 MB, нативная производительность
  - Меньше нагрузки на систему — критично для геймеров
- **WireGuard:** wireguard-nt через Rust FFI (Tauri нативно на Rust)
- **Маршруты:** Windows WinAPI через Rust (route add/delete для split-tunneling)
- **[НОВОЕ]** Авто-детект игр: мониторинг процессов через Windows API

### 6.2. Экраны

#### 1. Экран авторизации
- Вход: email/пароль
- **[НОВОЕ]** Вход через Telegram, Discord
- Показать план, остаток trial
- Ссылка на регистрацию

#### 2. Главный экран (Dashboard)
- **[НОВОЕ]** Текущий пинг до ближайшего узла (без подключения)
- Быстрый доступ к последним играм
- Статус подписки
- Кнопка "Quick Boost" для последней игры

#### 3. Экран выбора игры
- Поиск по названию
- Карточки игр: иконка, название, платформа, статус
- **[НОВОЕ]** Категории: FPS, MOBA, MMO, Battle Royale, Racing
- **[НОВОЕ]** Бейдж "Оптимизировано" для проверенных профилей
- Секция "Скоро": игры в разработке профиля

#### 4. Экран подключения (для выбранной игры)
- Список регионов/узлов:
  - **Авто** (рекомендованный, алгоритм выбора)
  - DE, SE, US, LV
  - Рядом: пинг до узла, загруженность (цветовой индикатор)
- Кнопка "Играть с ускорением"
- **[НОВОЕ]** Кнопка "Benchmark" — замерить ДО/ПОСЛЕ
- Опция: автозапуск .exe игры после подключения

#### 5. Dashboard активной сессии
- Крупный пинг (ms) с цветовым индикатором:
  - Зелёный: < 50ms
  - Жёлтый: 50–100ms
  - Красный: > 100ms
- Потери пакетов (%)
- **[НОВОЕ]** Jitter (ms)
- График пинга за последние 10 минут
- Схема маршрута: `Ты → Узел (DE) → Сервер игры`
- **[НОВОЕ]** Сравнение: "Без ускорения: 85ms → С ускорением: 32ms"
- Кнопка "Остановить ускорение"

#### 6. Настройки
- Автозапуск с Windows
- Язык: RU / EN
- **[НОВОЕ]** Тема: тёмная / светлая (по умолчанию тёмная — геймерская)
- **[НОВОЕ]** Уведомления: включить/выключить
- Логи (для отладки)
- **[НОВОЕ]** Раздел "О программе" с версией

#### 7. **[НОВОЕ]** Экран подписки
- Текущий план и дата окончания
- Тарифы с ценами
- Кнопка оплаты
- **Кнопка отмены подписки** (одним кликом, без скрытых шагов!)
- История платежей

### 6.3. Логика работы клиента

1. **Запуск** → проверка авторизации → загрузка списка игр и узлов через API
2. **Выбор игры** → регион → "Играть с ускорением"
3. **Клиент:**
   - `POST /sessions/start` → получает node + WG-конфиг + game_ips
   - **[НОВОЕ]** Замеряет ping_before (ICMP до game IP без туннеля)
   - Сохраняет конфиг, поднимает WireGuard-туннель
   - Добавляет маршруты для game_ips через WG-интерфейс
   - Замеряет ping_after → обновляет UI с разницей
   - Запускает игру (если авто-запуск)
4. **Во время сессии:**
   - Замеры пинга каждые 5 сек → обновление UI
   - Каждые 60 сек → push метрик в бэкенд
   - **[НОВОЕ]** Мониторинг процесса игры — если игра закрыта, предложить остановить ускорение
5. **Остановка:**
   - Выключение туннеля
   - Удаление маршрутов
   - `POST /sessions/stop` с финальными метриками

### 6.4. **[НОВОЕ]** Авто-детект игр

```
Клиент периодически (каждые 10 сек) проверяет список процессов Windows.
Сопоставляет с базой GameProfile.executable_names[].
При обнаружении → popup: "Обнаружена <Название игры>. Подключить ускорение?"
Если пользователь включил авто-подключение → автоматический старт сессии.
```

---

## 7. Landing-страница

### 7.1. Технология
- Next.js 14+ (App Router)
- Tailwind CSS
- **[НОВОЕ]** i18n: RU (основной) / EN
- **[НОВОЕ]** SEO-оптимизация для запросов "игровой ускоритель", "снизить пинг", "обход блокировок игр"

### 7.2. Блоки

#### Hero
- Заголовок: **"Низкий пинг и доступ к любым играм — без блокировок"**
- Подзаголовок: "Игровой ускоритель PLGames Booster UP с узлами в Германии, Швеции, США и Латвии. Оптимальный маршрут для геймеров из России и СНГ."
- Кнопки: "Скачать для Windows", "7 дней бесплатно"
- **[НОВОЕ]** Мини speed-test: "Проверить свой пинг" (WebSocket пинг до наших узлов прямо на странице)

#### Как это работает
- Схема: `Твой ПК → Наш узел → Игровой сервер`
- 3 шага:
  1. Выбираешь игру и регион
  2. Мы строим оптимальный маршрут трафика
  3. Играешь с низким пингом и без блокировок
- **[НОВОЕ]** Анимированная визуализация маршрута

#### **[НОВОЕ]** Benchmark-секция
- "Средний результат наших пользователей:"
  - Пинг: 95ms → 32ms (-66%)
  - Потери: 3.2% → 0.1%
- Кнопка "Проверить для своей игры"

#### Поддерживаемые игры
- Сетка логотипов: CS2, Dota 2, Valorant, LoL, Fortnite, PUBG, Apex Legends, Genshin Impact, etc.
- "Работает с любыми онлайн-играми, оптимизировано для 50+"

#### Преимущества
1. Низкий пинг (WireGuard, оптимизированный маршрут)
2. Обход блокировок (узлы вне РФ)
3. Не нагружает систему (Tauri, ~10 MB)
4. **[НОВОЕ]** Только игровой трафик (split-tunnel — остальное без изменений)
5. **[НОВОЕ]** Честный биллинг (отмена подписки в 1 клик)
6. **[НОВОЕ]** 7 дней бесплатно без карты

#### Тарифы

| | Free Trial | Pro Monthly | Pro Quarterly | Pro Yearly |
|---|---|---|---|---|
| Цена | $0 | $5.99/мес | $4.99/мес | $3.99/мес |
| Длительность | 7 дней | 1 мес | 3 мес | 12 мес |
| Узлы | Все | Все | Все | Все |
| Игры | Все | Все | Все | Все |
| Одновременных устройств | 1 | 2 | 2 | 3 |
| Приоритетный саппорт | Нет | Нет | Да | Да |

**[НОВОЕ]** Оплата:
- Карта (Stripe)
- **Robokassa** (для РФ)
- **Криптовалюта** (USDT, BTC) через Cryptomus
- **[НОВОЕ]** СБП (через Robokassa)

#### FAQ
1. "Это VPN?" → Нет, мы маршрутизируем только игровой трафик. Меньше потерь, ниже пинг, остальной трафик не затрагивается.
2. "За это банят?" → Ускоритель не модифицирует игру и не даёт преимуществ. Это легальный инструмент оптимизации сети.
3. "Какие платформы?" → Windows (сейчас), Android и Telegram-бот (скоро).
4. **[НОВОЕ]** "Как отменить подписку?" → В личном кабинете одной кнопкой. Никаких скрытых условий.
5. **[НОВОЕ]** "Работает ли в РФ?" → Да, сервис создан для геймеров из РФ и СНГ.

#### Footer
- Контакты (email, Telegram)
- Политика конфиденциальности
- Оферта
- **[НОВОЕ]** Telegram-канал с новостями
- **[НОВОЕ]** Discord-сервер

---

## 8. Производительность и качество

### Протокол
- WireGuard — минимальный оверхед (~1-3ms), ядерный модуль
- **[НОВОЕ]** На v2: рассмотреть надстройку для packet redundancy (дупликация UDP-пакетов по альтернативным путям, как у GearUP AIR)

### Split-tunneling
- Только игровые IP через туннель (из GameProfile.cidrs)
- Остальной трафик — напрямую
- **[НОВОЕ]** DNS-запросы игр тоже через туннель (предотвращение DNS-leak для обхода блокировок)

### Выбор узла
1. Предпочтение пользователя (если указано)
2. Рекомендация профиля игры
3. Метрики: RTT, loss, загрузка — лучший из доступных
4. **[НОВОЕ]** Fallback: если выбранный узел деградировал — автоматическое предложение переключиться

### **[НОВОЕ]** Защита от блокировок
- Мониторинг доступности WireGuard из РФ
- Подготовка obfuscation-слоя (obfs4/shadowsocks wrapper) на случай блокировки
- Альтернативные порты (443/UDP, 80/UDP) для маскировки трафика

---

## 9. Безопасность

### **[НОВОЕ]** Раздел безопасности

1. **Хранение ключей:** Приватные ключи WireGuard клиента генерируются на клиенте и НЕ отправляются на сервер. Сервер получает только публичный ключ.
2. **JWT:** Access token — 15 min, Refresh token — 7 дней, httpOnly cookie.
3. **Rate limiting:** API endpoints защищены через Redis-based rate limiter.
4. **Пароли:** bcrypt с cost=12.
5. **Секреты:** Все ключи в .env, не в коде. Docker secrets на проде.
6. **Логирование:** Не логируем игровой трафик пользователей. Только метаданные сессий.
7. **GDPR/ФЗ-152:** Минимальный сбор данных. Возможность удаления аккаунта.
